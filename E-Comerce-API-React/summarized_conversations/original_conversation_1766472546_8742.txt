{'role': 'assistant', 'content': '\nNow let me create the ProductDetail page:\n\n<function_calls>\n<create-file file_path="online-store-frontend/src/pages/ProductDetail.tsx">\nimport React, { useState, useEffect } from \'react\';\nimport {\n  Container,\n  Grid,\n  Card,\n  CardMedia,\n  Typography,\n  Button,\n  Box,\n  CircularProgress,\n  Alert,\n  Rating,\n  TextField,\n  IconButton,\n  List,\n  ListItem,\n  ListItemText,\n  Divider,\n  Chip,\n} from \'@mui/material\';\nimport { useParams, useNavigate } from \'react-router-dom\';\nimport { ShoppingCart, ArrowBack } from \'@mui/icons-material\';\nimport { productsApi, cartApi } from \'../services/api\';\nimport { Product, ProductReview } from \'../types\';\nimport { useAuth } from \'../contexts/AuthContext\';\n\nconst ProductDetail: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const { isAuthenticated } = useAuth();\n  const [product, setProduct] = useState<Product | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [quantity, setQuantity] = useState(1);\n  const [addingToCart, setAddingToCart] = useState(false);\n  const [reviewRating, setReviewRating] = useState(5);\n  const [reviewComment, setReviewComment] = useState(\'\');\n  const [submittingReview, setSubmittingReview] = useState(false);\n\n  useEffect(() => {\n    const fetchProduct = async () => {\n      if (!id) return;\n\n      try {\n        setLoading(true);\n        const productData = await productsApi.getProduct(parseInt(id));\n        setProduct(productData);\n      } catch (err) {\n        setError(\'Не удалось загрузить товар\');\n        console.error(\'Error fetching product:\', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchProduct();\n  }, [id]);\n\n  const handleAddToCart = async () => {\n    if (!isAuthenticated) {\n      navigate(\'/login\');\n      return;\n    }\n\n    if (!product) return;\n\n    try {\n      setAddingToCart(true);\n      await cartApi.addToCart(product.id, quantity);\n      // You could show a success message here\n    } catch (error) {\n      console.error(\'Error adding to cart:\', error);\n      // You could show an error message here\n    } finally {\n      setAddingToCart(false);\n    }\n  };\n\n  const handleSubmitReview = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!product || !isAuthenticated) return;\n\n    try {\n      setSubmittingReview(true);\n      await productsApi.createReview(product.id, {\n        rating: reviewRating,\n        comment: reviewComment,\n      });\n      \n      // Refresh product data to show new review\n      const updatedProduct = await productsApi.getProduct(product.id);\n      setProduct(updatedProduct);\n      \n      // Reset form\n      setReviewComment(\'\');\n      setReviewRating(5);\n    } catch (error) {\n      console.error(\'Error submitting review:\', error);\n      // You could show an error message here\n    } finally {\n      setSubmittingReview(false);\n    }\n  };\n\n  const formatPrice = (price: number, salePrice?: number) => {\n    if (salePrice && salePrice < price) {\n      return (\n        <Box>\n          <Typography variant="h6" color="text.secondary" sx={{ textDecoration: \'line-through\' }}>\n            ${price.toFixed(2)}\n          </Typography>\n          <Typography variant="h4" color="error">\n            ${salePrice.toFixed(2)}\n          </Typography>\n        </Box>\n      );\n    }\n    return <Typography variant="h4">${price.toFixed(2)}</Typography>;\n  };\n\n  if (loading) {\n    return (\n      <Container maxWidth="lg" sx={{ mt: 4, textAlign: \'center\' }}>\n        <CircularProgress />\n      </Container>\n    );\n  }\n\n  if (error || !product) {\n    return (\n      <Container maxWidth="lg" sx={{ mt: 4 }}>\n        <Alert severity="error">{error || \'Товар не найден\'}</Alert>\n      </Container>\n    );\n  }\n\n  return (\n    <Container maxWidth="lg">\n      <Button\n        startIcon={<ArrowBack />}\n        onClick={() => navigate(-1)}\n        sx={{ mb: 2 }}\n      >\n        Назад\n      </Button>\n\n      <Grid container spacing={4}>\n        {/* Product Image */}\n        <Grid item xs={12} md={6}>\n          <Card>\n            <CardMedia\n              component="img"\n              image={product.imageUrl || `https://picsum.photos/seed/${product.id}/600/600.jpg`}\n              alt={product.name}\n              sx={{ height: 600, objectFit: \'cover\' }}\n            />\n          </Card>\n        </Grid>\n\n        {/* Product Info */}\n        <Grid item xs={12} md={6}>\n          <Typography variant="h4" component="h1" gutterBottom>\n            {product.name}\n          </Typography>\n\n          <Box sx={{ mb: 2 }}>\n            <Rating value={product.averageRating} precision={0.1} readOnly />\n            <Typography variant="body2" color="text.secondary" sx={{ ml: 1 }}>\n              ({product.reviews.length} отзывов)\n            </Typography>\n          </Box>\n\n          {formatPrice(product.price, product.salePrice)}\n\n          <Typography variant="body1" sx={{ my: 3 }}>\n            {product.description}\n          </Typography>\n\n          <Box sx={{ mb: 3 }}>\n            <Typography variant="body2" color="text.secondary">\n              Категория: {product.category.name}\n            </Typography>\n            <Typography variant="body2" color="text.secondary">\n              В наличии: {product.stockQuantity} шт.\n            </Typography>\n            {product.isFeatured && (\n              <Chip label="Рекомендуемый" color="primary" size="small" sx={{ mt: 1 }} />\n            )}\n          </Box>\n\n          {/* Quantity and Add to Cart */}\n          <Box sx={{ mb: 4 }}>\n            <Typography variant="h6" gutterBottom>\n              Количество:\n            </Typography>\n            <Box sx={{ display: \'flex\', alignItems: \'center\', gap: 2 }}>\n              <TextField\n                type="number"\n                value={quantity}\n                onChange={(e) => setQuantity(Math.max(1, parseInt(e.target.value) || 1))}\n                inputProps={{ min: 1, max: product.stockQuantity }}\n                sx={{ width: 100 }}\n              />\n              <Button\n                variant="contained"\n                size="large"\n                startIcon={<ShoppingCart />}\n                onClick={handleAddToCart}\n                disabled={addingToCart || product.stockQuantity === 0}\n              >\n                {addingToCart ? \'Добавление...\' : \'В корзину\'}\n              </Button>\n            </Box>\n            {product.stockQuantity === 0 && (\n              <Typography color="error" sx={{ mt: 1 }}>\n                Товар временно отсутствует\n              </Typography>\n            )}\n          </Box>\n        </Grid>\n      </Grid>\n\n      {/* Reviews Section */}\n      <Box sx={{ mt: 6 }}>\n        <Typography variant="h4" component="h2" gutterBottom>\n          Отзывы\n        </Typography>\n\n        {/* Add Review Form */}\n        {isAuthenticated && (\n          <Box component="form" onSubmit={handleSubmitReview} sx={{ mb: 4 }}>\n            <Typography variant="h6" gutterBottom>\n              Оставить отзыв\n            </Typography>\n            <Box sx={{ mb: 2 }}>\n              <Rating\n                value={reviewRating}\n                onChange={(_, newValue) => setReviewRating(newValue || 5)}\n              />\n            </Box>\n            <TextField\n              fullWidth\n              multiline\n              rows={3}\n              placeholder="Ваш отзыв..."\n              value={reviewComment}\n              onChange={(e) => setReviewComment(e.target.value)}\n              required\n              sx={{ mb: 2 }}\n            />\n            <Button\n              type="submit"\n              variant="contained"\n              disabled={submittingReview}\n            >\n              {submittingReview ? \'Отправка...\' : \'Отправить отзыв\'}\n            </Button>\n          </Box>\n        )}\n\n        {/* Reviews List */}\n        {product.reviews.length === 0 ? (\n          <Typography color="text.secondary">\n            Пока нет отзывов. Будьте первым!\n          </Typography>\n        ) : (\n          <List>\n            {product.reviews.map((review) => (\n              <React.Fragment key={review.id}>\n                <ListItem alignItems="flex-start">\n                  <ListItemText\n                    primary={\n                      <Box sx={{ display: \'flex\', alignItems: \'center\', gap: 2 }}>\n                        <Typography variant="subtitle1">\n                          {review.user.firstName} {review.user.lastName}\n                        </Typography>\n                        <Rating value={review.rating} size="small" readOnly />\n                      </Box>\n                    }\n                    secondary={\n                      <>\n                        <Typography variant="body2" color="text.secondary">\n                          {new Date(review.createdAt).toLocaleDateString()}\n                        </Typography>\n                        <Typography variant="body1" sx={{ mt: 1 }}>\n                          {review.comment}\n                        </Typography>\n                      </>\n                    }\n                  />\n                </ListItem>\n                <Divider variant="inset" component="li" />\n              </React.Fragment>\n            ))}\n          </List>\n        )}\n      </Box>\n    </Container>\n  );\n};\n\nexport default ProductDetail;\n</create-file>\n</function_calls>'}