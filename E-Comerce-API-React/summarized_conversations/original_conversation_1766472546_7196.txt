{'role': 'assistant', 'content': '\nNow let me create the Products page:\n\n<function_calls>\n<create-file file_path="online-store-frontend/src/pages/Products.tsx">\nimport React, { useState, useEffect } from \'react\';\nimport {\n  Container,\n  Typography,\n  Grid,\n  Card,\n  CardMedia,\n  CardContent,\n  CardActions,\n  Button,\n  Box,\n  CircularProgress,\n  Alert,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  Pagination,\n  Fab,\n} from \'@mui/material\';\nimport { useNavigate } from \'react-router-dom\';\nimport { ShoppingCart, Search } from \'@mui/icons-material\';\nimport { productsApi, categoriesApi, cartApi } from \'../services/api\';\nimport { Product, Category } from \'../types\';\nimport { useAuth } from \'../contexts/AuthContext\';\n\nconst Products: React.FC = () => {\n  const navigate = useNavigate();\n  const { isAuthenticated } = useAuth();\n  const [products, setProducts] = useState<Product[]>([]);\n  const [categories, setCategories] = useState<Category[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\'\');\n  const [selectedCategory, setSelectedCategory] = useState<number | \'\'>(\'\');\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [addingToCart, setAddingToCart] = useState<number | null>(null);\n\n  const pageSize = 12;\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        setLoading(true);\n        \n        // Fetch categories\n        const categoriesData = await categoriesApi.getCategories();\n        setCategories(categoriesData);\n\n        // Fetch products\n        const response = await productsApi.getProducts(\n          currentPage,\n          pageSize,\n          selectedCategory || undefined,\n          searchTerm || undefined\n        );\n        \n        setProducts(response.items || response);\n        setTotalPages(response.totalPages || Math.ceil(response.length / pageSize));\n      } catch (err) {\n        setError(\'Не удалось загрузить товары\');\n        console.error(\'Error fetching data:\', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, [currentPage, selectedCategory, searchTerm]);\n\n  const handleSearch = (event: React.FormEvent) => {\n    event.preventDefault();\n    setCurrentPage(1);\n  };\n\n  const handleCategoryChange = (event: any) => {\n    setSelectedCategory(event.target.value);\n    setCurrentPage(1);\n  };\n\n  const handleProductClick = (productId: number) => {\n    navigate(`/products/${productId}`);\n  };\n\n  const handleAddToCart = async (productId: number) => {\n    if (!isAuthenticated) {\n      navigate(\'/login\');\n      return;\n    }\n\n    try {\n      setAddingToCart(productId);\n      await cartApi.addToCart(productId, 1);\n      // You could show a success message here\n    } catch (error) {\n      console.error(\'Error adding to cart:\', error);\n      // You could show an error message here\n    } finally {\n      setAddingToCart(null);\n    }\n  };\n\n  const formatPrice = (price: number, salePrice?: number) => {\n    if (salePrice && salePrice < price) {\n      return (\n        <Box>\n          <Typography variant="body2" color="text.secondary" sx={{ textDecoration: \'line-through\' }}>\n            ${price.toFixed(2)}\n          </Typography>\n          <Typography variant="h6" color="error">\n            ${salePrice.toFixed(2)}\n          </Typography>\n        </Box>\n      );\n    }\n    return <Typography variant="h6">${price.toFixed(2)}</Typography>;\n  };\n\n  if (loading) {\n    return (\n      <Container maxWidth="lg" sx={{ mt: 4, textAlign: \'center\' }}>\n        <CircularProgress />\n      </Container>\n    );\n  }\n\n  return (\n    <Container maxWidth="lg">\n      <Typography variant="h4" component="h1" gutterBottom>\n        Товары\n      </Typography>\n\n      {/* Search and Filter */}\n      <Box component="form" onSubmit={handleSearch} sx={{ mb: 4 }}>\n        <Grid container spacing={2} alignItems="center">\n          <Grid item xs={12} md={6}>\n            <TextField\n              fullWidth\n              placeholder="Поиск товаров..."\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              InputProps={{\n                startAdornment: <Search sx={{ mr: 1 }} />,\n              }}\n            />\n          </Grid>\n          <Grid item xs={12} md={4}>\n            <FormControl fullWidth>\n              <InputLabel>Категория</InputLabel>\n              <Select\n                value={selectedCategory}\n                onChange={handleCategoryChange}\n                label="Категория"\n              >\n                <MenuItem value="">Все категории</MenuItem>\n                {categories.map((category) => (\n                  <MenuItem key={category.id} value={category.id}>\n                    {category.name}\n                  </MenuItem>\n                ))}\n              </Select>\n            </FormControl>\n          </Grid>\n          <Grid item xs={12} md={2}>\n            <Button type="submit" variant="contained" fullWidth>\n              Поиск\n            </Button>\n          </Grid>\n        </Grid>\n      </Box>\n\n      {error && (\n        <Alert severity="error" sx={{ mb: 3 }}>\n          {error}\n        </Alert>\n      )}\n\n      {products.length === 0 ? (\n        <Box textAlign="center" py={4}>\n          <Typography color="text.secondary">\n            Товары не найдены\n          </Typography>\n        </Box>\n      ) : (\n        <>\n          <Grid container spacing={4}>\n            {products.map((product) => (\n              <Grid item key={product.id} xs={12} sm={6} md={4} lg={3}>\n                <Card\n                  sx={{\n                    height: \'100%\',\n                    display: \'flex\',\n                    flexDirection: \'column\',\n                    transition: \'transform 0.2s, box-shadow 0.2s\',\n                    \'&:hover\': {\n                      transform: \'translateY(-4px)\',\n                      boxShadow: 4,\n                    },\n                  }}\n                >\n                  <CardMedia\n                    component="img"\n                    height="200"\n                    image={product.imageUrl || `https://picsum.photos/seed/${product.id}/400/300.jpg`}\n                    alt={product.name}\n                    sx={{ objectFit: \'cover\' }}\n                  />\n                  <CardContent sx={{ flexGrow: 1 }}>\n                    <Typography variant="h6" component="h3" gutterBottom>\n                      {product.name}\n                    </Typography>\n                    <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>\n                      {product.description.length > 80\n                        ? `${product.description.substring(0, 80)}...`\n                        : product.description}\n                    </Typography>\n                    {formatPrice(product.price, product.salePrice)}\n                    <Box sx={{ display: \'flex\', alignItems: \'center\', mt: 1 }}>\n                      <Typography variant="body2" color="text.secondary">\n                        ⭐ {product.averageRating.toFixed(1)}\n                      </Typography>\n                      <Typography variant="body2" color="text.secondary" sx={{ ml: 2 }}>\n                        ({product.reviews.length} отзывов)\n                      </Typography>\n                    </Box>\n                  </CardContent>\n                  <CardActions sx={{ p: 2, pt: 0 }}>\n                    <Button\n                      size="small"\n                      color="primary"\n                      onClick={() => handleProductClick(product.id)}\n                    >\n                      Подробнее\n                    </Button>\n                    <Button\n                      size="small"\n                      color="secondary"\n                      startIcon={<ShoppingCart />}\n                      onClick={() => handleAddToCart(product.id)}\n                      disabled={addingToCart === product.id || product.stockQuantity === 0}\n                    >\n                      {addingToCart === product.id ? \'Добавление...\' : \'В корзину\'}\n                    </Button>\n                  </CardActions>\n                </Card>\n              </Grid>\n            ))}\n          </Grid>\n\n          {/* Pagination */}\n          {totalPages > 1 && (\n            <Box sx={{ display: \'flex\', justifyContent: \'center\', mt: 4 }}>\n              <Pagination\n                count={totalPages}\n                page={currentPage}\n                onChange={(_, page) => setCurrentPage(page)}\n                color="primary"\n              />\n            </Box>\n          )}\n        </>\n      )}\n    </Container>\n  );\n};\n\nexport default Products;\n</create-file>\n</function_calls>'}